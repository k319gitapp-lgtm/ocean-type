<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OCEAN Type â€” æ€§æ ¼è¨ºæ–­</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --E:#6c63ff; --O:#f59e0b; --P:#10b981; --H:#3b82f6; --S:#ec4899;
      --bg:#f0f4f8; --card:#ffffff; --text:#1e293b; --muted:#64748b;
      --border:#e2e8f0; --radius:16px; --shadow:0 4px 24px rgba(0,0,0,.08);
    }
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }

    .screen { display:none; }
    .screen.active { display:block; }

    /* â”€â”€ START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #screen-start { min-height:100vh; display:none; flex-direction:column; align-items:center; justify-content:center; padding:32px 20px; text-align:center; }
    #screen-start.active { display:flex; }
    .logo { font-size:48px; font-weight:900; letter-spacing:-2px; background:linear-gradient(135deg,var(--E),var(--S)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:8px; }
    .logo-sub { font-size:14px; color:var(--muted); margin-bottom:48px; letter-spacing:2px; text-transform:uppercase; }
    .mode-cards { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; max-width:640px; width:100%; }
    .mode-card { flex:1; min-width:260px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:32px 28px; cursor:pointer; border:2px solid transparent; transition:border-color .2s,transform .2s,box-shadow .2s; text-align:left; }
    .mode-card:hover { border-color:var(--E); transform:translateY(-4px); box-shadow:0 8px 32px rgba(108,99,255,.15); }
    .mode-card .badge { display:inline-block; background:linear-gradient(135deg,var(--E),var(--S)); color:#fff; font-size:11px; font-weight:700; letter-spacing:1px; text-transform:uppercase; padding:4px 10px; border-radius:20px; margin-bottom:16px; }
    .mode-card h2 { font-size:22px; font-weight:800; margin-bottom:8px; }
    .mode-card .meta { font-size:13px; color:var(--muted); margin-bottom:12px; }
    .mode-card p { font-size:14px; color:var(--muted); line-height:1.6; }
    .mode-card .btn-start { display:block; margin-top:20px; background:var(--E); color:#fff; font-size:14px; font-weight:700; padding:12px 0; border-radius:10px; text-align:center; }
    .mode-card:hover .btn-start { background:#5b52e8; }
    .ocean-strip { display:flex; gap:8px; margin-top:48px; flex-wrap:wrap; justify-content:center; }
    .ocean-strip span { font-size:12px; font-weight:700; padding:5px 12px; border-radius:20px; color:#fff; }

    /* â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #screen-quiz { min-height:100vh; display:none; flex-direction:column; align-items:center; padding:0 20px 60px; }
    #screen-quiz.active { display:flex; }
    .quiz-header { width:100%; max-width:680px; padding:28px 0 16px; }
    .progress-row { display:flex; align-items:center; gap:12px; margin-bottom:10px; }
    .progress-label { font-size:13px; color:var(--muted); white-space:nowrap; }
    .progress-bar-outer { flex:1; height:8px; background:var(--border); border-radius:4px; overflow:hidden; }
    .progress-bar-inner { height:100%; background:linear-gradient(90deg,var(--E),var(--S)); border-radius:4px; transition:width .4s ease; }
    .quiz-card { width:100%; max-width:680px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:40px 40px 36px; }
    .dim-badge { display:inline-block; font-size:11px; font-weight:800; letter-spacing:1px; text-transform:uppercase; padding:4px 12px; border-radius:20px; color:#fff; margin-bottom:20px; }
    .question-text { font-size:22px; font-weight:700; line-height:1.5; margin-bottom:36px; min-height:66px; }
    .likert { display:flex; flex-direction:column; gap:10px; margin-bottom:36px; }
    .likert-btn { display:flex; align-items:center; gap:14px; padding:14px 18px; border-radius:12px; border:2px solid var(--border); cursor:pointer; background:#fff; transition:border-color .15s,background .15s,transform .1s; }
    .likert-btn:hover { border-color:#c4bfff; background:#f5f4ff; transform:translateX(3px); }
    .likert-btn.selected { border-color:var(--E); background:#f0eeff; }
    .likert-num { width:30px; height:30px; border-radius:50%; background:var(--border); display:flex; align-items:center; justify-content:center; font-size:13px; font-weight:800; color:var(--muted); flex-shrink:0; transition:background .15s,color .15s; }
    .likert-btn.selected .likert-num { background:var(--E); color:#fff; }
    .likert-label { font-size:14px; color:var(--text); }
    .quiz-nav { display:flex; justify-content:space-between; align-items:center; }
    .btn { padding:12px 28px; border-radius:10px; font-size:15px; font-weight:700; cursor:pointer; border:none; transition:opacity .15s,transform .1s; }
    .btn:active { transform:scale(.97); }
    .btn-primary { background:var(--E); color:#fff; }
    .btn-primary:disabled { opacity:.4; cursor:not-allowed; }
    .btn-ghost { background:transparent; color:var(--muted); border:2px solid var(--border); }
    .btn-ghost:disabled { opacity:.3; cursor:not-allowed; }

    /* â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #screen-loading { min-height:100vh; display:none; flex-direction:column; align-items:center; justify-content:center; gap:24px; text-align:center; }
    #screen-loading.active { display:flex; }
    .spinner { width:56px; height:56px; border-radius:50%; border:5px solid var(--border); border-top-color:var(--E); animation:spin .8s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .loading-text { font-size:18px; font-weight:600; color:var(--muted); }

    /* â”€â”€ RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #screen-result { min-height:100vh; display:none; flex-direction:column; align-items:center; padding:40px 20px 80px; }
    #screen-result.active { display:flex; }
    .result-section { width:100%; max-width:720px; margin-bottom:20px; }
    .result-hero { background:linear-gradient(135deg,#6c63ff 0%,#ec4899 100%); border-radius:var(--radius); color:#fff; padding:44px 40px; text-align:center; }
    .result-type-code { font-size:13px; font-weight:700; letter-spacing:4px; opacity:.8; margin-bottom:8px; }
    .result-type-name { font-size:44px; font-weight:900; letter-spacing:-1px; margin-bottom:16px; }
    .result-description { font-size:15px; line-height:1.8; opacity:.92; max-width:520px; margin:0 auto; }
    .card { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:28px 32px; }
    .card-title { font-size:13px; font-weight:700; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:16px; }
    .detail-text { font-size:15px; line-height:1.9; color:var(--text); }

    /* Radar + Scores */
    .chart-scores-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    @media(max-width:640px){ .chart-scores-grid{grid-template-columns:1fr;} }
    .chart-inner { display:flex; flex-direction:column; align-items:center; }
    .score-row { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .score-dim-badge { width:30px; height:30px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:900; color:#fff; flex-shrink:0; }
    .score-bar-outer { flex:1; height:10px; background:var(--border); border-radius:5px; overflow:hidden; }
    .score-bar-inner { height:100%; border-radius:5px; transition:width 1s ease; }
    .score-value { font-size:13px; font-weight:700; min-width:36px; text-align:right; }
    .score-letter { font-size:14px; font-weight:900; min-width:18px; text-align:center; }

    /* SW */
    .sw-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    @media(max-width:560px){ .sw-grid{grid-template-columns:1fr;} }
    .sw-title { font-size:13px; font-weight:700; letter-spacing:1px; text-transform:uppercase; margin-bottom:14px; }
    .sw-title.s { color:#10b981; }
    .sw-title.w { color:#f59e0b; }
    .sw-list { list-style:none; display:flex; flex-direction:column; gap:10px; }
    .sw-list li { display:flex; align-items:flex-start; gap:10px; font-size:14px; line-height:1.5; }
    .sw-list li::before { content:''; width:8px; height:8px; border-radius:50%; flex-shrink:0; margin-top:5px; }
    .sw-list.s li::before { background:#10b981; }
    .sw-list.w li::before { background:#f59e0b; }

    /* Dimension explanation */
    .dim-explain-grid { display:flex; flex-direction:column; gap:16px; }
    .dim-explain-row { display:flex; gap:14px; align-items:flex-start; }
    .dim-explain-badge { width:38px; height:38px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:900; color:#fff; flex-shrink:0; }
    .dim-explain-body { flex:1; }
    .dim-explain-title { font-size:14px; font-weight:700; margin-bottom:4px; }
    .dim-explain-desc { font-size:13px; color:var(--muted); line-height:1.7; }
    .dhl { font-weight:700; }

    /* All 32 types */
    .types-group-label { font-size:12px; font-weight:700; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:10px; margin-top:18px; }
    .types-group-label:first-child { margin-top:0; }
    .types-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; }
    @media(max-width:540px){ .types-grid{grid-template-columns:repeat(2,1fr);} }
    .type-chip { border-radius:10px; padding:10px 8px 8px; background:#f8fafc; border:2px solid var(--border); cursor:pointer; transition:border-color .15s,background .15s,transform .1s; text-align:center; }
    .type-chip:hover { border-color:var(--E); background:#f0eeff; transform:translateY(-2px); }
    .type-chip.mine { border-color:var(--E); background:#f0eeff; }
    .type-chip-code { font-size:10px; font-weight:900; letter-spacing:1px; color:var(--muted); }
    .type-chip.mine .type-chip-code { color:var(--E); }
    .type-chip-name { font-size:13px; font-weight:700; color:var(--text); margin-top:3px; }
    .type-chip-you { display:inline-block; font-size:9px; font-weight:700; background:var(--E); color:#fff; padding:1px 6px; border-radius:8px; margin-top:4px; }

    /* Compatibility */
    .compat-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    @media(max-width:600px){ .compat-grid{grid-template-columns:1fr;} }
    .compat-section-title { font-size:13px; font-weight:700; letter-spacing:1px; text-transform:uppercase; margin-bottom:16px; }
    .compat-section-title.good { color:#10b981; }
    .compat-section-title.bad  { color:#f59e0b; }
    .compat-list { display:flex; flex-direction:column; gap:14px; }
    .compat-item { border-radius:12px; border:1.5px solid var(--border); overflow:hidden; }
    .compat-header { display:flex; align-items:center; gap:10px; padding:12px 14px; background:#f8fafc; }
    .compat-rank { font-size:11px; font-weight:900; color:var(--muted); min-width:22px; }
    .compat-code { font-size:11px; font-weight:900; letter-spacing:1px; padding:3px 8px; border-radius:6px; color:#fff; }
    .compat-name { font-size:15px; font-weight:700; flex:1; }
    .compat-match-badge { font-size:11px; font-weight:700; color:var(--muted); white-space:nowrap; }
    .compat-body { padding:12px 14px; display:flex; flex-direction:column; gap:10px; }
    .compat-row { display:flex; gap:8px; font-size:13px; line-height:1.6; }
    .compat-row-icon { width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:11px; flex-shrink:0; margin-top:1px; }
    .compat-row-icon.why { background:#ede9fe; }
    .compat-row-icon.how { background:#d1fae5; }
    .compat-row-text { flex:1; color:var(--text); }
    .compat-row-label { font-weight:700; margin-right:4px; }

    /* Retry */
    .result-footer { text-align:center; margin-top:12px; }
    .btn-retry { background:var(--card); color:var(--E); border:2px solid var(--E); padding:14px 40px; border-radius:12px; font-size:16px; font-weight:700; cursor:pointer; transition:background .15s,color .15s; }
    .btn-retry:hover { background:var(--E); color:#fff; }

    /* â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay { position:fixed; inset:0; background:rgba(15,23,42,.6); z-index:9999; display:none; align-items:center; justify-content:center; padding:20px; backdrop-filter:blur(6px); }
    .modal-overlay.open { display:flex; }
    .modal-card { background:#fff; border-radius:20px; max-width:580px; width:100%; max-height:90vh; overflow-y:auto; position:relative; box-shadow:0 25px 60px rgba(0,0,0,.25); animation:modalIn .2s ease; }
    @keyframes modalIn { from { opacity:0; transform:translateY(14px) scale(.97); } }
    .modal-header { padding:32px 32px 24px; color:#fff; border-radius:20px 20px 0 0; position:relative; }
    .modal-close-btn { position:absolute; top:14px; right:14px; width:34px; height:34px; border-radius:50%; background:rgba(255,255,255,.25); border:none; cursor:pointer; color:#fff; font-size:18px; display:flex; align-items:center; justify-content:center; line-height:1; transition:background .15s; }
    .modal-close-btn:hover { background:rgba(255,255,255,.4); }
    .modal-type-code { font-size:11px; font-weight:700; letter-spacing:4px; opacity:.8; margin-bottom:6px; }
    .modal-type-name { font-size:32px; font-weight:900; letter-spacing:-1px; }
    .modal-you-badge { display:inline-block; font-size:11px; font-weight:700; background:rgba(255,255,255,.3); color:#fff; padding:3px 10px; border-radius:20px; margin-top:8px; }
    .modal-body { padding:24px 32px 32px; }
    .modal-section { margin-bottom:20px; }
    .modal-section-title { font-size:12px; font-weight:700; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-bottom:10px; }
    .modal-desc { font-size:14px; line-height:1.8; color:var(--text); margin-bottom:12px; }
    .modal-detail { font-size:13px; line-height:1.8; color:var(--muted); }
    .modal-sw-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:4px; }
    @media(max-width:480px){ .modal-sw-grid{grid-template-columns:1fr;} }
    .modal-sw-list { list-style:none; display:flex; flex-direction:column; gap:8px; }
    .modal-sw-list li { display:flex; align-items:flex-start; gap:8px; font-size:13px; line-height:1.5; }
    .modal-sw-list li::before { content:''; width:7px; height:7px; border-radius:50%; flex-shrink:0; margin-top:4px; }
    .modal-sw-list.s li::before { background:#10b981; }
    .modal-sw-list.w li::before { background:#f59e0b; }
    .modal-sw-subtitle { font-size:12px; font-weight:700; margin-bottom:8px; }
    .modal-sw-subtitle.s { color:#10b981; }
    .modal-sw-subtitle.w { color:#f59e0b; }

    @media(max-width:600px){
      .quiz-card { padding:28px 20px 24px; }
      .question-text { font-size:18px; }
      .result-hero { padding:32px 24px; }
      .result-type-name { font-size:32px; }
      .card { padding:22px 20px; }
      .modal-body { padding:20px 20px 28px; }
      .modal-header { padding:24px 20px 20px; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="screen-start" class="screen active">
  <div class="logo">OCEAN Type</div>
  <div class="logo-sub">Big Five æ€§æ ¼è¨ºæ–­ Â· 32ã‚¿ã‚¤ãƒ—</div>
  <div class="mode-cards">
    <div class="mode-card" onclick="startQuiz('short')">
      <h2>ã‹ã‚“ãŸã‚“è¨ºæ–­</h2>
      <div class="meta">20å• Â· ç´„5åˆ†</div>
      <p>å„æ¬¡å…ƒ4å•ãšã¤ã®ã‚³ã‚¢ãªè³ªå•ã§ã€ã‚ãªãŸã®æ€§æ ¼ã‚¿ã‚¤ãƒ—ã‚’ç´ æ—©ãè¨ºæ–­ã—ã¾ã™ã€‚</p>
      <div class="btn-start">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ â†’</div>
    </div>
    <div class="mode-card" onclick="startQuiz('full')">
      <h2>ã—ã£ã‹ã‚Šè¨ºæ–­</h2>
      <div class="meta">100å• Â· ç´„20åˆ†</div>
      <p>å„æ¬¡å…ƒ20å•ã®è©³ç´°ãªè³ªå•ã§ã€ã‚ˆã‚Šç²¾åº¦ã®é«˜ã„è¨ºæ–­çµæœã‚’æä¾›ã—ã¾ã™ã€‚</p>
      <div class="btn-start">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ â†’</div>
    </div>
  </div>
  <div class="ocean-strip">
    <span style="background:var(--E)">å¤–å‘æ€§ E/I</span>
    <span style="background:var(--O)">é©æ–°æ€§ O/T</span>
    <span style="background:var(--P)">è¨ˆç”»æ€§ P/F</span>
    <span style="background:var(--H)">å”èª¿æ€§ H/D</span>
    <span style="background:var(--S)">å®‰å®šæ€§ S/R</span>
  </div>
  <div style="margin-top:24px">
    <button class="btn btn-ghost" onclick="openAllTypesModal()" style="border-color:var(--E);color:var(--E)">å…¨32ã‚¿ã‚¤ãƒ—ä¸€è¦§ã‚’è¦‹ã‚‹ â†’</button>
  </div>
</div>

<!-- â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="screen-quiz" class="screen">
  <div class="quiz-header">
    <div style="display:flex;justify-content:flex-start;margin-bottom:10px">
      <button class="btn btn-ghost" onclick="confirmGoHome()" style="font-size:13px;padding:8px 16px">â† TOPã¸æˆ»ã‚‹</button>
    </div>
    <div class="progress-row">
      <span class="progress-label" id="progress-label">1 / 20</span>
      <div class="progress-bar-outer"><div class="progress-bar-inner" id="progress-bar" style="width:0%"></div></div>
    </div>
  </div>
  <div class="quiz-card">
    <div id="dim-badge" class="dim-badge"></div>
    <div id="question-text" class="question-text"></div>
    <div class="likert">
      <div class="likert-btn" data-val="1" onclick="selectAnswer(1)"><div class="likert-num">1</div><div class="likert-label">ã¨ã¦ã‚‚ã‚ã¦ã¯ã¾ã‚‹</div></div>
      <div class="likert-btn" data-val="2" onclick="selectAnswer(2)"><div class="likert-num">2</div><div class="likert-label">ã‚„ã‚„ã‚ã¦ã¯ã¾ã‚‹</div></div>
      <div class="likert-btn" data-val="3" onclick="selectAnswer(3)"><div class="likert-num">3</div><div class="likert-label">ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„</div></div>
      <div class="likert-btn" data-val="4" onclick="selectAnswer(4)"><div class="likert-num">4</div><div class="likert-label">ã‚ã¾ã‚Šã‚ã¦ã¯ã¾ã‚‰ãªã„</div></div>
      <div class="likert-btn" data-val="5" onclick="selectAnswer(5)"><div class="likert-num">5</div><div class="likert-label">å…¨ãã‚ã¦ã¯ã¾ã‚‰ãªã„</div></div>
    </div>
    <div class="quiz-nav">
      <button class="btn btn-ghost" id="btn-prev" onclick="prevQuestion()" disabled>â† å‰ã¸</button>
      <button class="btn btn-primary" id="btn-next" onclick="nextQuestion()" disabled>æ¬¡ã¸ â†’</button>
    </div>
  </div>
</div>

<!-- â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="screen-loading" class="screen">
  <div class="spinner"></div>
  <div class="loading-text">è¨ºæ–­ä¸­...</div>
</div>

<!-- â”€â”€ RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="screen-result" class="screen">

  <div class="result-section">
    <div class="result-hero">
      <div class="result-type-code" id="result-type-code"></div>
      <div class="result-type-name" id="result-type-name"></div>
      <div class="result-description" id="result-description"></div>
    </div>
  </div>

  <div class="result-section">
    <div class="card">
      <div class="card-title">ã‚ãªãŸã®ç‰¹å¾´</div>
      <div class="detail-text" id="result-detail"></div>
    </div>
  </div>

  <div class="result-section">
    <div class="card">
      <div class="card-title" style="margin-bottom:20px">æ€§æ ¼ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ</div>
      <div class="chart-scores-grid">
        <div class="chart-inner"><canvas id="radar-canvas" width="300" height="300"></canvas></div>
        <div>
          <div class="card-title">5æ¬¡å…ƒã‚¹ã‚³ã‚¢</div>
          <div id="score-rows"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="result-section">
    <div class="sw-grid">
      <div class="card"><div class="sw-title s">å¼·ã¿</div><ul class="sw-list s" id="strengths-list"></ul></div>
      <div class="card"><div class="sw-title w">å¼±ã¿ãƒ»æ³¨æ„ç‚¹</div><ul class="sw-list w" id="weaknesses-list"></ul></div>
    </div>
  </div>

  <!-- 5 dimensions explanation -->
  <div class="result-section">
    <div class="card">
      <div class="card-title">5ã¤ã®æ¬¡å…ƒã«ã¤ã„ã¦</div>
      <div class="dim-explain-grid">
        <div class="dim-explain-row">
          <div class="dim-explain-badge" style="background:var(--E)">E/I</div>
          <div class="dim-explain-body">
            <div class="dim-explain-title"><span class="dhl" style="color:var(--E)">å¤–å‘æ€§ (E)</span> vs <span class="dhl" style="color:var(--E)">å†…å‘æ€§ (I)</span></div>
            <div class="dim-explain-desc">ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å‘ã‹ã†æ–¹å‘ã‚’ç¤ºã™æ¬¡å…ƒã€‚<b>Eï¼ˆå¤–å‘ï¼‰</b>ã¯ä»–è€…ã¨ã®äº¤æµã‹ã‚‰æ´»åŠ›ã‚’å¾—ã‚‹ç¤¾äº¤çš„ãªç‰¹æ€§ã€‚<b>Iï¼ˆå†…å‘ï¼‰</b>ã¯ä¸€äººã®æ™‚é–“ã‚„å†…çœã‹ã‚‰ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è£œå……ã™ã‚‹ç‰¹æ€§ã€‚å……é›»ã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ã§ã‚ã‚Šã€ã©ã¡ã‚‰ãŒå„ªã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>
          </div>
        </div>
        <div class="dim-explain-row">
          <div class="dim-explain-badge" style="background:var(--O)">O/T</div>
          <div class="dim-explain-body">
            <div class="dim-explain-title"><span class="dhl" style="color:var(--O)">é©æ–°æ€§ (O)</span> vs <span class="dhl" style="color:var(--O)">ä¼çµ±æ€§ (T)</span></div>
            <div class="dim-explain-desc">ã‚¢ã‚¤ãƒ‡ã‚¢ã¨å¤‰åŒ–ã¸ã®å§¿å‹¢ã‚’ç¤ºã™æ¬¡å…ƒã€‚<b>Oï¼ˆé©æ–°ï¼‰</b>ã¯å¥½å¥‡å¿ƒæ—ºç››ã§æ–°ã—ã„çµŒé¨“ãƒ»æŠ½è±¡çš„ãªæ€è€ƒã‚’å¥½ã‚€ç‰¹æ€§ã€‚<b>Tï¼ˆä¼çµ±ï¼‰</b>ã¯å®‰å®šãƒ»æ…£ç¿’ãƒ»å®Ÿç”¨çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’é‡ã‚“ã˜ã‚‹ç‰¹æ€§ã€‚</div>
          </div>
        </div>
        <div class="dim-explain-row">
          <div class="dim-explain-badge" style="background:var(--P)">P/F</div>
          <div class="dim-explain-body">
            <div class="dim-explain-title"><span class="dhl" style="color:var(--P)">è¨ˆç”»æ€§ (P)</span> vs <span class="dhl" style="color:var(--P)">æŸ”è»Ÿæ€§ (F)</span></div>
            <div class="dim-explain-desc">æ„æ€æ±ºå®šã¨ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¤ºã™æ¬¡å…ƒã€‚<b>Pï¼ˆè¨ˆç”»ï¼‰</b>ã¯æ§‹é€ ãƒ»çµ„ç¹”ãƒ»æ±ºå®šã‚’å¥½ã‚€ç‰¹æ€§ã€‚<b>Fï¼ˆæŸ”è»Ÿï¼‰</b>ã¯é–‹æ”¾çš„ãƒ»è‡¨æ©Ÿå¿œå¤‰ãƒ»è‡ªç™ºçš„ãªç”Ÿãæ–¹ã‚’å¥½ã‚€ç‰¹æ€§ã€‚</div>
          </div>
        </div>
        <div class="dim-explain-row">
          <div class="dim-explain-badge" style="background:var(--H)">H/D</div>
          <div class="dim-explain-body">
            <div class="dim-explain-title"><span class="dhl" style="color:var(--H)">å”èª¿æ€§ (H)</span> vs <span class="dhl" style="color:var(--H)">è‡ªå¾‹æ€§ (D)</span></div>
            <div class="dim-explain-desc">äººé–“é–¢ä¿‚ã®å–ã‚Šæ–¹ã‚’ç¤ºã™æ¬¡å…ƒã€‚<b>Hï¼ˆå”èª¿ï¼‰</b>ã¯ä»–è€…ã¨ã®èª¿å’Œãƒ»å”åŠ›ãƒ»å…±æ„Ÿã‚’é‡è¦–ã™ã‚‹ç‰¹æ€§ã€‚<b>Dï¼ˆè‡ªå¾‹ï¼‰</b>ã¯ç‹¬ç«‹å¿ƒãŒå¼·ãã€è‡ªå·±ã®åˆ¤æ–­ãƒ»ç«¶äº‰ãƒ»è‡ªç«‹ã‚’é‡è¦–ã™ã‚‹ç‰¹æ€§ã€‚</div>
          </div>
        </div>
        <div class="dim-explain-row">
          <div class="dim-explain-badge" style="background:var(--S)">S/R</div>
          <div class="dim-explain-body">
            <div class="dim-explain-title"><span class="dhl" style="color:var(--S)">å®‰å®šæ€§ (S)</span> vs <span class="dhl" style="color:var(--S)">æ•æ„Ÿæ€§ (R)</span></div>
            <div class="dim-explain-desc">æ„Ÿæƒ…ã®æºã‚Œå¹…ã‚’ç¤ºã™æ¬¡å…ƒã€‚<b>Sï¼ˆå®‰å®šï¼‰</b>ã¯æ„Ÿæƒ…çš„ã«ç©ã‚„ã‹ã§ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ãŒé«˜ã„ç‰¹æ€§ã€‚<b>Rï¼ˆæ•æ„Ÿï¼‰</b>ã¯æ„Ÿå—æ€§ãŒè±Šã‹ã§æ„Ÿæƒ…ã®èµ·ä¼ãŒå¤§ããã€ä¸–ç•Œã‚’ç¹Šç´°ã«æ„Ÿã˜å–ã‚‹ç‰¹æ€§ã€‚</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- All 32 types -->
  <div class="result-section">
    <div class="card">
      <div class="card-title">å…¨32ã‚¿ã‚¤ãƒ—ä¸€è¦§ <span style="font-size:11px;font-weight:400;color:var(--muted);letter-spacing:0;text-transform:none">â€” ã‚¿ã‚¤ãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</span></div>
      <div class="types-group-label">å¤–å‘å‹ï¼ˆEï¼‰</div>
      <div class="types-grid" id="types-grid-e"></div>
      <div class="types-group-label">å†…å‘å‹ï¼ˆIï¼‰</div>
      <div class="types-grid" id="types-grid-i"></div>
    </div>
  </div>

  <!-- Compatibility -->
  <div class="result-section">
    <div class="compat-grid">
      <div class="card">
        <div class="compat-section-title good">ç›¸æ€§ã®è‰¯ã„æ€§æ ¼ TOP 3</div>
        <div class="compat-list" id="compat-good"></div>
      </div>
      <div class="card">
        <div class="compat-section-title bad">ç›¸æ€§ã®è‰¯ããªã„æ€§æ ¼ TOP 3</div>
        <div class="compat-list" id="compat-bad"></div>
      </div>
    </div>
  </div>

  <div class="result-section result-footer">
    <button class="btn-retry" onclick="goHome()">ã‚„ã‚Šç›´ã™</button>
  </div>
</div>

<!-- â”€â”€ ALL TYPES MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="all-types-modal" onclick="handleAllTypesModalOverlay(event)">
  <div class="modal-card" style="max-width:720px">
    <div class="modal-header" style="background:linear-gradient(135deg,#6c63ff,#ec4899)">
      <button class="modal-close-btn" onclick="closeAllTypesModal()">âœ•</button>
      <div class="modal-type-code">OCEAN TYPE</div>
      <div class="modal-type-name">å…¨32ã‚¿ã‚¤ãƒ—ä¸€è¦§</div>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--muted);margin-bottom:16px">ã‚¿ã‚¤ãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
      <div class="types-group-label">å¤–å‘å‹ï¼ˆEï¼‰</div>
      <div class="types-grid" id="all-types-grid-e"></div>
      <div class="types-group-label" style="margin-top:18px">å†…å‘å‹ï¼ˆIï¼‰</div>
      <div class="types-grid" id="all-types-grid-i"></div>
    </div>
  </div>
</div>

<!-- â”€â”€ TYPE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="type-modal" onclick="handleModalOverlayClick(event)">
  <div class="modal-card" id="modal-card">
    <div class="modal-header" id="modal-header">
      <button class="modal-close-btn" onclick="closeTypeModal()">âœ•</button>
      <div class="modal-type-code" id="modal-type-code"></div>
      <div class="modal-type-name" id="modal-type-name"></div>
      <div id="modal-you-badge"></div>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <div class="modal-section-title">ã‚¿ã‚¤ãƒ—æ¦‚è¦</div>
        <div class="modal-desc" id="modal-desc"></div>
        <div class="modal-detail" id="modal-detail"></div>
      </div>
      <div class="modal-section">
        <div class="modal-section-title">å¼·ã¿ãƒ»å¼±ã¿</div>
        <div class="modal-sw-grid">
          <div>
            <div class="modal-sw-subtitle s">å¼·ã¿</div>
            <ul class="modal-sw-list s" id="modal-strengths"></ul>
          </div>
          <div>
            <div class="modal-sw-subtitle w">å¼±ã¿</div>
            <ul class="modal-sw-list w" id="modal-weaknesses"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // â”€â”€ Injected type data (from server via Jinja2) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const TYPE_DATA = {{ type_data_json | safe }};

  // â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DIM_COLORS  = { E:'#6c63ff', O:'#f59e0b', P:'#10b981', H:'#3b82f6', S:'#ec4899' };
  const DIM_NAMES   = { E:'å¤–å‘æ€§', O:'é©æ–°æ€§', P:'è¨ˆç”»æ€§', H:'å”èª¿æ€§', S:'å®‰å®šæ€§' };
  const DIM_PAIRS   = { E:'E/I', O:'O/T', P:'P/F', H:'H/D', S:'S/R' };

  const ALL_TYPES_E = [
    ['EOPHS','å…ˆé§†è€…'],['EOPHR','é–‹æ‹“è€…'],['EOPDS','æˆ¦ç•¥å®¶'],['EOPDR','åéª¨è€…'],
    ['EOFHS','æ¼”å‡ºå®¶'],['EOFHR','å…±æ„Ÿè€…'],['EOFDS','æ¢æ¤œå®¶'],['EOFDR','å¥”æ”¾è€…'],
    ['ETPHS','çµ±ç‡è€…'],['ETPHR','å®ˆè­·è€…'],['ETPDS','ç›£ç£è€…'],['ETPDR','æŒ‘æˆ¦è€…'],
    ['ETFHS','èª¿æ•´è€…'],['ETFHR','æ”¯æ´è€…'],['ETFDS','å®Ÿå‹™å®¶'],['ETFDR','è·äºº'],
  ];
  const ALL_TYPES_I = [
    ['IOPHS','ç™ºæ˜å®¶'],['IOPHR','è©©äºº'],  ['IOPDS','å“²å­¦è€…'],['IOPDR','å†…çœè€…'],
    ['IOFHS','å¤¢æƒ³å®¶'],['IOFHR','ç¹Šç´°è€…'],['IOFDS','å€‹äººä¸»ç¾©è€…'],['IOFDR','ç¥ç§˜å®¶'],
    ['ITPHS','ç ”ç©¶è€…'],['ITPHR','ç•ªäºº'],  ['ITPDS','åˆ†æå®¶'],['ITPDR','æ±‚é“è€…'],
    ['ITFHS','èª¿å’Œè€…'],['ITFHR','å…±é³´è€…'],['ITFDS','å­¤é«˜ã®åŒ '],['ITFDR','éš è€…'],
  ];

  // â”€â”€ Compatibility explanation templates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Why two types with the SAME letter in a dimension are compatible
  const SAME_WHY = {
    E: 'å¤–å‘çš„ãªç¤¾äº¤ã‚¹ã‚¿ã‚¤ãƒ«ãŒå…±é³´ã—ã€ä¸€ç·’ã«ã„ã¦æ´»åŠ›ãŒç”Ÿã¾ã‚Œã¾ã™',
    I: 'å†…çœã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ãŒä¸€è‡´ã—ã€äº’ã„ã®é™ã‹ãªæ™‚é–“ã‚’è‡ªç„¶ã«å°Šé‡ã§ãã¾ã™',
    O: 'é©æ–°çš„ãªç™ºæƒ³ã¨çŸ¥çš„å¥½å¥‡å¿ƒãŒå…±é³´ã—ã¾ã™',
    T: 'å®‰å®šãƒ»ä¼çµ±ã‚’é‡ã‚“ã˜ã‚‹ä¾¡å€¤è¦³ãŒä¸€è‡´ã—ã¾ã™',
    P: 'è¨ˆç”»çš„ãƒ»çµ„ç¹”çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒä¸€è‡´ã—ã¾ã™',
    F: 'æŸ”è»Ÿã§è‡ªç™ºçš„ãªã‚¹ã‚¿ã‚¤ãƒ«ãŒå…±é³´ã—ã¾ã™',
    H: 'å”èª¿ãƒ»å’Œã‚’å¤§åˆ‡ã«ã™ã‚‹å§¿å‹¢ãŒä¸€è‡´ã—ã¾ã™',
    D: 'ç‹¬ç«‹å¿ƒã¨è‡ªå¾‹çš„ãªå§¿å‹¢ãŒå…±é³´ã—ã¾ã™',
    S: 'æ„Ÿæƒ…ã®å®‰å®šã—ãŸãƒšãƒ¼ã‚¹ãŒè¿‘ãã€è½ã¡ç€ã„ãŸé–¢ä¿‚ã«ãªã‚Šã‚„ã™ã„ã§ã™',
    R: 'è±Šã‹ãªæ„Ÿå—æ€§ãŒå…±é³´ã—ã€ç´°ã‚„ã‹ãªæ„Ÿæƒ…ã®ã‚„ã‚Šå–ã‚ŠãŒã§ãã¾ã™',
  };

  // Per-dimension info for DIFFERING letters
  const DIFF_INFO = {
    E: {
      why_compat:   'ç¤¾äº¤ã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ãŒæ–°é®®ãªåˆºæ¿€ã‚’ã‚‚ãŸã‚‰ã—ã¾ã™',
      why_incompat: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼å……é›»ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¤–å‘â†”å†…å‘ï¼‰ãŒå¯¾ç…§çš„ã§ã€è¡Œå‹•ãƒšãƒ¼ã‚¹ã®ãšã‚ŒãŒç”Ÿã˜ã‚„ã™ã„ã§ã™',
      how_compat:   'å¤–å‘å´ã¯ç›¸æ‰‹ã®ä¸€äººã®æ™‚é–“ã‚’å°Šé‡ã—ã€å†…å‘å´ã¯äº¤æµã®å ´ã«å°‘ã—å‚åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†',
      how_incompat: 'å¤–å‘å´ã¯ç›¸æ‰‹ã‚’æ€¥ã‹ã•ãšé™ã‹ãªç’°å¢ƒã‚‚æä¾›ã—ã€å†…å‘å´ã¯ç›¸æ‰‹ã®äº¤æµæ¬²æ±‚ã«å°‘ã—å¿œãˆã‚‹å·¥å¤«ã‚’ã—ã¾ã—ã‚‡ã†',
    },
    O: {
      why_compat:   'æ€è€ƒã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ãŒäº’ã„ã®è¦–é‡ã‚’åºƒã’ã¾ã™',
      why_incompat: 'å¤‰åŒ–ãƒ»æ–°ã—ã•ã¸ã®å§¿å‹¢ï¼ˆé©æ–°â†”ä¼çµ±ï¼‰ãŒå¯¾ç…§çš„ã§ã€ã‚¢ã‚¤ãƒ‡ã‚¢ã®å—ã‘å–ã‚Šæ–¹ã«æ¸©åº¦å·®ãŒå‡ºã‚„ã™ã„ã§ã™',
      how_compat:   'é©æ–°å´ã¯æ ¹æ‹ ã‚’æ·»ãˆã¦ææ¡ˆã—ã€ä¼çµ±å´ã¯æ–°ã—ã„è¦–ç‚¹ã‚’ã¾ãšä¸€æ—¦å—ã‘æ­¢ã‚ã‚‹å§¿å‹¢ãŒå¤§åˆ‡ã§ã™',
      how_incompat: 'é©æ–°å´ã¯å¤‰åŒ–ã®ãƒ¡ãƒªãƒƒãƒˆã‚’ä¸å¯§ã«èª¬æ˜ã—ã€ä¼çµ±å´ã¯å…¨å¦å®šã‚ˆã‚Šã€Œä¸€åº¦è©¦ã™ã€å§¿å‹¢ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†',
    },
    P: {
      why_compat:   'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ãŒè£œã„åˆã†é–¢ä¿‚ã‚’ç”Ÿã¿ã¾ã™',
      why_incompat: 'è¨ˆç”»â†”æŸ”è»Ÿã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¯¾ç…§çš„ã§ã€æ®µå–ã‚Šã¸ã®æ¸©åº¦å·®ãŒæ‘©æ“¦ã‚’ç”Ÿã¿ã‚„ã™ã„ã§ã™',
      how_compat:   'è¨ˆç”»å´ã¯å¤§æ ã®ã¿å…±æœ‰ã—ç´°éƒ¨ã«ä½™åœ°ã‚’æ®‹ã™ã€æŸ”è»Ÿå´ã¯æœ€ä½é™ã®æœŸæ—¥ã‚’å®ˆã‚‹ã“ã¨ã§å”åŠ›ã§ãã¾ã™',
      how_incompat: 'è¨ˆç”»å´ã¯ã™ã¹ã¦ã‚’æ±ºã‚ã‚ˆã†ã¨ã›ãšä½™ç™½ã‚’æ®‹ã—ã€æŸ”è»Ÿå´ã¯ã€Œå¾Œã§è€ƒãˆã‚‹ã€ã‚’æ¸›ã‚‰ã™åŠªåŠ›ãŒå¤§åˆ‡ã§ã™',
    },
    H: {
      why_compat:   'å¯¾äººã‚¹ã‚¿ã‚¤ãƒ«ã®é•ã„ãŒãƒãƒ©ãƒ³ã‚¹ã®ã‚ˆã„é–¢ä¿‚ã‚’ç”Ÿã¿ã¾ã™',
      why_incompat: 'å”èª¿â†”è‡ªå¾‹ã®å¯¾äººã‚¹ã‚¿ã‚¤ãƒ«ãŒå¯¾ç…§çš„ã§ã€æ„Ÿæƒ…çš„ãªã™ã‚Œé•ã„ãŒèµ·ãã‚„ã™ã„ã§ã™',
      how_compat:   'å”èª¿å´ã¯ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’å°Šé‡ã—ã€è‡ªå¾‹å´ã¯ç›¸æ‰‹ã®ã€Œå’Œã€ã¸ã®é…æ…®ã‚’å¦å®šã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†',
      how_incompat: 'å”èª¿å´ã¯NOã‚‚ä¼ãˆã‚‰ã‚Œã‚‹ã‚ˆã†æ„è­˜ã—ã€è‡ªå¾‹å´ã¯ç›¸æ‰‹ã®æ„Ÿæƒ…ã«å°‘ã—æ°—ã‚’é…ã‚‹ã‚ˆã†åŠªã‚ã¾ã—ã‚‡ã†',
    },
    S: {
      why_compat:   'æ„Ÿæƒ…ã®æºã‚Œå¹…ã®é•ã„ãŒäº’ã„ã‚’è£œå®Œã—ã¾ã™',
      why_incompat: 'æ„Ÿæƒ…ã®å®‰å®šåº¦ãƒ»æ„Ÿå—æ€§ã®å¼·ã•ï¼ˆå®‰å®šâ†”æ•æ„Ÿï¼‰ãŒå¯¾ç…§çš„ã§ã€æ„Ÿæƒ…é¢ã§ã®ã™ã‚Œé•ã„ãŒèµ·ãã‚„ã™ã„ã§ã™',
      how_compat:   'å®‰å®šå´ã¯æ„Ÿæƒ…è¡¨ç¾ã‚’å¦å®šã›ãšå—ã‘æ­¢ã‚ã€æ•æ„Ÿå´ã¯å†·é™ãªåå¿œã‚’ã€Œå†·ãŸã„ã€ã¨èª¤è§£ã—ãªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†',
      how_incompat: 'å®‰å®šå´ã¯æ„Ÿæƒ…ã¸ã®è¨€è‘‰ãŒã‘ã‚’æ„è­˜ã—ã€æ•æ„Ÿå´ã¯æ„Ÿæƒ…ã‚’æ•´ç†ã—ã¦ã‹ã‚‰è©±ã™ã¨ä¼ã‚ã‚Šã‚„ã™ã„ã§ã™',
    },
  };

  function generateCompatExplanation(myCode, theirCode, isGood) {
    const DIMS = ['E','O','P','H','S'];
    const same = [], diff = [];
    DIMS.forEach((d, i) => {
      if (myCode[i] === theirCode[i]) same.push({ dim: d, letter: myCode[i] });
      else diff.push({ dim: d });
    });

    let why = '', how = '';

    if (isGood) {
      // Why: list shared traits concisely
      if (same.length >= 3) {
        // Compact: "â—‹â—‹ãƒ»â—‹â—‹ãƒ»â—‹â—‹ ãŒå…±é³´ã—ã¾ã™"
        const pts = same.map(s => SAME_WHY[s.letter]);
        why = pts.slice(0, 3).join('ã€') + 'ã¨ã„ã†ç‚¹ãŒå…±é³´ã—ã¾ã™ã€‚';
        if (diff.length === 1 && DIFF_INFO[diff[0].dim]) {
          why += DIFF_INFO[diff[0].dim].why_compat + 'ã¨ã„ã†é¢ã‚‚ã‚ã‚Šã¾ã™ã€‚';
        }
      } else {
        why = same.map(s => SAME_WHY[s.letter]).join('ã€') + 'ã¨ã„ã†ç‚¹ãŒå…±é³´ã—ã¾ã™ã€‚';
      }
      // How
      const howParts = diff.map(d => DIFF_INFO[d.dim]?.how_compat).filter(Boolean);
      how = howParts.length ? howParts.join('ã¾ãŸã€') : 'ãŠäº’ã„ã®å¼·ã¿ã‚’ç©æ¥µçš„ã«è¨€èªåŒ–ã—ã¦ä¼ãˆåˆã„ã¾ã—ã‚‡ã†ã€‚';

    } else {
      // Why: focus on differences
      const diffParts = diff.slice(0, 4).map(d => DIFF_INFO[d.dim]?.why_incompat).filter(Boolean);
      why = diffParts.join('ã€‚') + 'ã€‚';
      if (same.length > 0) {
        why += `ä¸€æ–¹ã§${same.map(s => SAME_WHY[s.letter]).join('ã€')}ã¨ã„ã†å…±é³´ç‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚`;
      }
      // How: top 3 differing dims
      const howParts = diff.slice(0, 3).map(d => DIFF_INFO[d.dim]?.how_incompat).filter(Boolean);
      how = howParts.length ? howParts.join('ã¾ãŸã€') : 'ã¾ãšã¯å…±é€šã®è©±é¡Œã‹ã‚‰å°‘ã—ãšã¤äº¤æµã‚’æ·±ã‚ã¾ã—ã‚‡ã†ã€‚';
    }

    return { why, how };
  }

  // â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let questions = [], answers = {}, current = 0, mode = 'short';
  let myTypeCode = '';

  // â”€â”€ Screens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('screen-' + id).classList.add('active');
    window.scrollTo(0, 0);
  }
  function goHome() { questions = []; answers = {}; current = 0; myTypeCode = ''; showScreen('start'); }
  function confirmGoHome() {
    if (confirm('è¨ºæ–­ã‚’ä¸­æ–­ã—ã¦TOPç”»é¢ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ\nï¼ˆå›ç­”å†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ï¼‰')) goHome();
  }

  // â”€â”€ All Types Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openAllTypesModal() {
    renderTypeGrid('all-types-grid-e', ALL_TYPES_E, '');
    renderTypeGrid('all-types-grid-i', ALL_TYPES_I, '');
    document.getElementById('all-types-modal').classList.add('open');
    document.body.style.overflow = 'hidden';
  }
  function closeAllTypesModal() {
    document.getElementById('all-types-modal').classList.remove('open');
    document.body.style.overflow = '';
  }
  function handleAllTypesModalOverlay(e) {
    if (e.target === document.getElementById('all-types-modal')) closeAllTypesModal();
  }

  // â”€â”€ Quiz â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function startQuiz(m) {
    mode = m; answers = {}; current = 0;
    showScreen('loading');
    const res = await fetch('/questions?mode=' + mode);
    questions = await res.json();
    showScreen('quiz');
    renderQuestion();
  }

  function renderQuestion() {
    const q = questions[current], tot = questions.length;
    document.getElementById('progress-label').textContent = `${current + 1} / ${tot}`;
    document.getElementById('progress-bar').style.width = `${(current + 1) / tot * 100}%`;

    const badge = document.getElementById('dim-badge');
    badge.textContent = DIM_NAMES[q.dimension] + ' â€” ' + q.dimension;
    badge.style.background = DIM_COLORS[q.dimension];

    document.getElementById('question-text').textContent = q.text;

    const saved = answers[q.id];
    document.querySelectorAll('.likert-btn').forEach(btn => {
      btn.classList.toggle('selected', parseInt(btn.dataset.val) === saved);
    });

    document.getElementById('btn-prev').disabled = (current === 0);
    const btnNext = document.getElementById('btn-next');
    btnNext.textContent = current === tot - 1 ? 'è¨ºæ–­ã™ã‚‹ âœ“' : 'æ¬¡ã¸ â†’';
    btnNext.disabled = !saved;
  }

  function selectAnswer(displayVal) {
    answers[questions[current].id] = displayVal;
    document.querySelectorAll('.likert-btn').forEach(btn => {
      btn.classList.toggle('selected', parseInt(btn.dataset.val) === displayVal);
    });
    document.getElementById('btn-next').disabled = false;
    // No auto-advance â€” user must press æ¬¡ã¸
  }

  function prevQuestion() { if (current > 0) { current--; renderQuestion(); } }
  function nextQuestion() {
    if (!answers[questions[current].id]) return;
    if (current < questions.length - 1) { current++; renderQuestion(); }
    else submitAnswers();
  }

  // â”€â”€ Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function submitAnswers() {
    showScreen('loading');
    // Convert: display 1(ã¨ã¦ã‚‚)â†’server 5, display 5(å…¨ã)â†’server 1
    const serverAnswers = {};
    for (const [id, dv] of Object.entries(answers)) serverAnswers[id] = 6 - dv;

    const res = await fetch('/score', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ mode, answers: serverAnswers }),
    });
    const data = await res.json();
    renderResult(data);
    showScreen('result');
  }

  // â”€â”€ Render result â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderResult(data) {
    myTypeCode = data.type_code;

    document.getElementById('result-type-code').textContent  = data.type_code;
    document.getElementById('result-type-name').textContent  = data.type_name;
    document.getElementById('result-description').textContent = data.description;
    document.getElementById('result-detail').textContent      = data.detail;

    // Score bars
    const rowsEl = document.getElementById('score-rows');
    rowsEl.innerHTML = '';
    ['E','O','P','H','S'].forEach(d => {
      const sc = data.scores[d], tl = data.type_letters[d], col = DIM_COLORS[d];
      rowsEl.innerHTML += `
        <div class="score-row">
          <div class="score-dim-badge" style="background:${col};width:44px;height:26px;font-size:11px">${DIM_PAIRS[d]}</div>
          <div class="score-bar-outer"><div class="score-bar-inner" style="width:${sc}%;background:${col}"></div></div>
          <div class="score-value" style="color:${col}">${sc.toFixed(1)}</div>
          <div class="score-letter" style="color:${col}">${tl}</div>
        </div>`;
    });

    // Strengths / Weaknesses
    document.getElementById('strengths-list').innerHTML  = data.strengths.map(s => `<li>${s}</li>`).join('');
    document.getElementById('weaknesses-list').innerHTML = data.weaknesses.map(w => `<li>${w}</li>`).join('');

    // 32-type grid
    renderTypeGrid('types-grid-e', ALL_TYPES_E, data.type_code);
    renderTypeGrid('types-grid-i', ALL_TYPES_I, data.type_code);

    // Compatibility
    renderCompat('compat-good', data.compatible,   data.type_code, true);
    renderCompat('compat-bad',  data.incompatible, data.type_code, false);

    // Radar
    requestAnimationFrame(() => drawRadar(data.scores, data.type_letters));
  }

  function renderTypeGrid(containerId, typeList, myCode) {
    document.getElementById(containerId).innerHTML = typeList.map(([code, name]) => {
      const isMe = code === myCode;
      return `<div class="type-chip ${isMe ? 'mine' : ''}" onclick="openTypeModal('${code}')">
        <div class="type-chip-code">${code}</div>
        <div class="type-chip-name">${name}</div>
        ${isMe ? '<div class="type-chip-you">ã‚ãªãŸ</div>' : ''}
      </div>`;
    }).join('');
  }

  function renderCompat(containerId, list, myCode, isGood) {
    document.getElementById(containerId).innerHTML = list.map((item, i) => {
      const { why, how } = generateCompatExplanation(myCode, item.code, isGood);
      const col = isGood ? '#10b981' : '#f59e0b';
      return `<div class="compat-item">
        <div class="compat-header">
          <div class="compat-rank">#${i + 1}</div>
          <div class="compat-code" style="background:${col}">${item.code}</div>
          <div class="compat-name">${item.name}</div>
          <div class="compat-match-badge">${item.matches}/5ä¸€è‡´</div>
        </div>
        <div class="compat-body">
          <div class="compat-row">
            <div class="compat-row-icon why">ğŸ’¡</div>
            <div class="compat-row-text"><span class="compat-row-label">ç†ç”±</span>${why}</div>
          </div>
          <div class="compat-row">
            <div class="compat-row-icon how">ğŸ¤</div>
            <div class="compat-row-text"><span class="compat-row-label">ã‚³ãƒ„</span>${how}</div>
          </div>
        </div>
      </div>`;
    }).join('');
  }

  // â”€â”€ Type Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Map type code first-letter to gradient colors
  const MODAL_GRADIENTS = {
    E: 'linear-gradient(135deg,#6c63ff,#ec4899)',
    I: 'linear-gradient(135deg,#3b82f6,#8b5cf6)',
  };

  function openTypeModal(code) {
    const t = TYPE_DATA[code];
    if (!t) return;

    document.getElementById('modal-type-code').textContent = code;
    document.getElementById('modal-type-name').textContent = t.name;
    document.getElementById('modal-desc').textContent      = t.description;
    document.getElementById('modal-detail').textContent    = t.detail;
    document.getElementById('modal-strengths').innerHTML   = t.strengths.map(s => `<li>${s}</li>`).join('');
    document.getElementById('modal-weaknesses').innerHTML  = t.weaknesses.map(w => `<li>${w}</li>`).join('');

    // You badge
    const youEl = document.getElementById('modal-you-badge');
    youEl.innerHTML = code === myTypeCode ? '<div class="modal-you-badge">ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—</div>' : '';

    // Header gradient
    document.getElementById('modal-header').style.background =
      code[0] === 'E' ? MODAL_GRADIENTS.E : MODAL_GRADIENTS.I;

    document.getElementById('type-modal').classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeTypeModal() {
    document.getElementById('type-modal').classList.remove('open');
    document.body.style.overflow = '';
  }

  function handleModalOverlayClick(e) {
    if (e.target === document.getElementById('type-modal')) closeTypeModal();
  }

  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeTypeModal(); });

  // â”€â”€ Radar chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function drawRadar(scores, typeLetters) {
    const canvas = document.getElementById('radar-canvas');
    const ctx = canvas.getContext('2d');
    const W = canvas.width, H = canvas.height;
    const cx = W/2, cy = H/2, radius = Math.min(cx, cy) - 52;
    const DIMS = ['E','O','P','H','S'];
    const n = 5, step = (2*Math.PI)/n, start = -Math.PI/2;

    function pt(i, r) {
      const a = start + i * step;
      return { x: cx + r*Math.cos(a), y: cy + r*Math.sin(a) };
    }

    ctx.clearRect(0, 0, W, H);

    // Grid
    for (let lvl = 1; lvl <= 5; lvl++) {
      ctx.beginPath();
      const r = radius * lvl / 5;
      for (let i = 0; i < n; i++) {
        const p = pt(i, r);
        i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y);
      }
      ctx.closePath();
      ctx.strokeStyle = lvl === 5 ? 'rgba(0,0,0,.13)' : 'rgba(0,0,0,.07)';
      ctx.lineWidth = 1; ctx.stroke();
    }

    // Axes
    for (let i = 0; i < n; i++) {
      const p = pt(i, radius);
      ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(p.x, p.y);
      ctx.strokeStyle = 'rgba(0,0,0,.12)'; ctx.lineWidth = 1; ctx.stroke();
    }

    // Data polygon
    ctx.beginPath();
    DIMS.forEach((d, i) => {
      const p = pt(i, radius * scores[d] / 100);
      i === 0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y);
    });
    ctx.closePath();
    ctx.fillStyle = 'rgba(108,99,255,.22)'; ctx.fill();
    ctx.strokeStyle = '#6c63ff'; ctx.lineWidth = 2.5; ctx.stroke();

    // Dots + labels
    DIMS.forEach((d, i) => {
      const sc = scores[d], col = DIM_COLORS[d], tl = typeLetters[d];
      const dp = pt(i, radius * sc / 100);
      ctx.beginPath(); ctx.arc(dp.x, dp.y, 5, 0, 2*Math.PI);
      ctx.fillStyle = col; ctx.fill();
      ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();

      const lp = pt(i, radius + 42);
      ctx.font = 'bold 14px -apple-system,sans-serif';
      ctx.fillStyle = col; ctx.textAlign = 'center'; ctx.textBaseline = 'bottom';
      ctx.fillText(tl, lp.x, lp.y);
      ctx.font = '10px -apple-system,sans-serif';
      ctx.fillStyle = '#64748b'; ctx.textBaseline = 'top';
      ctx.fillText(sc.toFixed(1), lp.x, lp.y + 2);
    });
  }
</script>
</body>
</html>
